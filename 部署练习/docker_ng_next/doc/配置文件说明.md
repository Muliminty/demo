# 配置文件说明

## 1. next.config.ts

```typescript
output: 'standalone'
```

- **作用**：生成最小化的独立构建，只包含运行所需的文件
- **优势**：大幅减小 Docker 镜像体积，加快构建速度

## 2. Dockerfile

**多阶段构建流程**：
1. **builder 阶段**：安装依赖，构建 Next.js 应用
2. **runner 阶段**：只复制构建产物，运行应用

**关键文件复制**：
- `public/`：静态资源
- `.next/standalone/`：standalone 构建输出（包含 server.js）
- `.next/static/`：静态资源文件

**关键点**：
- 多阶段构建：builder 阶段构建应用，runner 阶段运行应用
- 只复制必要文件：使用 standalone 模式，只需复制 `.next/standalone` 和静态文件
- 非 root 用户运行：提高安全性

## 3. docker-compose.yml

**服务配置**：
- `nextjs`：Next.js 应用服务，内部运行在 3000 端口
- `nginx`：反向代理服务，对外暴露 4041 端口

**网络配置**：
- 使用自定义网络 `app-network`
- 服务间通过服务名通信（`http://nextjs:3000`）

**关键配置**：
- `nextjs` 服务：构建和运行 Next.js 应用，不直接暴露端口
- `nginx` 服务：反向代理，对外暴露 4041 端口
- `depends_on`：确保 Next.js 服务先启动
- 自定义网络：服务间通过服务名（`nextjs`）通信

## 4. nginx/nginx.conf

**反向代理配置**：
- 所有请求代理到 `http://nextjs:3000`
- 支持 WebSocket（用于 HMR 等）
- 静态资源缓存优化

**关键配置**：
- `proxy_pass http://nextjs:3000`：通过服务名 `nextjs` 访问 Next.js 服务
- WebSocket 支持：`Upgrade` 和 `Connection` 头，支持 HMR 等功能
- 静态资源缓存：优化 `/_next/static` 路径的缓存策略

## 5. .dockerignore

**作用**：告诉 Docker 在构建镜像时忽略哪些文件和目录

**好处**：
- 减少构建镜像时的上下文大小
- 加快构建速度
- 确保敏感或无关文件不会被打包进最终镜像
- 提升安全性和生产环境的干净整洁度

## 6. .gitignore

**作用**：告诉 Git 忽略哪些文件和目录

**重要配置**：
- `nginx/logs/`：Nginx 日志目录，不应提交到 git
