services:
  # Next.js 应用服务
  nextjs:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: nextjs-app
    restart: always
    networks:
      - app-network
    # 不直接暴露端口，只通过 Nginx 访问

  # Nginx 反向代理服务
  nginx:
    image: nginx:alpine
    container_name: nextjs-nginx
    ports:
      - "4041:4041"
    volumes:
      # 挂载 Nginx 配置文件
      - ./nginx/nginx.conf:/etc/nginx/conf.d/app.conf
      # 挂载 Nginx 日志到宿主机
      - ./nginx/logs:/var/log/nginx
    restart: always
    depends_on:
      - nextjs
    networks:
      - app-network

# 自定义网络（让 Nginx 和 Next.js 服务互通）
networks:
  app-network:
    driver: bridge